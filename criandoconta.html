<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vip cortes</title>
    <link rel="stylesheet" href="conta.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Big+Shoulders:opsz,wght@10..72,100..900&display=swap"
        rel="stylesheet">
</head>

<body>
    <header>
        <div class="traco1">
            <img class="tracos" src="./assets/menu (sidebar).png" alt="3 traços">
        </div>
        <div class="caixa-one">
            <img class="img-one" src="./assets/Vip cortes logo.png" alt="logo">
            <a class="item" href="./index.html"><b>Home</b></a>
            <a class="item" href="./Avaliações.html"><b>Avaliações</b></a>
            <a class="item" href="./AGENDAR.html"><b>Agendar</b></a>

        </div>

        <div class="caixa-two">
            <a class="item-two" href="./cartaofidelidade.html"><b>Entrar</b></a>
            <a class="item-three" href="./criandoconta.html"><b>Cadastre-se</b></a>

        </div>
    </header>
    <div class="line"></div>
    <section>
        <span class="item-four"><b>CARTÃO</b></span>
        <span class="item-five"><b>FIDELIDADE</b></span>

    </section>
    <main>
        <img src="./assets/tela 2.png" alt="tela" class="tela">
        <div class="caixa-none">
            <span class="fidelidade">Criando Conta</SPan>
        </div>
        <div class="caixa-ten">

            <form class="formulario" id="formulario">

                <input id="Nome" type="text" placeholder="Nome:" class="botao">

                <input id="Telefone" type="text" placeholder="Telefone:" class="botao2">

                <input id="Data" type="text" placeholder="Data de Nascimento:" class="botao3">

                <input id="Senha" type="text" placeholder="Crie uma senha:" class="botao4">

                <div class="caixa-vinte">

                    <button type="submit" class=" botao5">Enviar e Entrar</button>

                </div>
            </form>

        </div>
    <script>
        const formulario = document.getElementById('formulario');

        formulario.addEventListener('submit', async (e) => {
            e.preventDefault();

            const nome = document.getElementById('Nome').value.trim();
            const telefone = document.getElementById('Telefone').value.trim();
            const nascimento = document.getElementById('Data').value.trim();
            const senha = document.getElementById('Senha').value;

            if (!nome || !telefone || !nascimento || !senha) {
                alert('Por favor, preencha todos os campos');
                return;
            }

            try {
                const res = await fetch('/api/usuarios/criar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nome, telefone, nascimento, senha })
                });
                const data = await res.json();
                if (res.ok) {
                    sessionStorage.setItem('usuarioId', data.usuarioId);
                    sessionStorage.setItem('usuarioNome', data.usuarioNome || nome);
                    sessionStorage.setItem('usuarioTelefone', telefone);
                    sessionStorage.setItem('autenticado', 'true');
                    window.location.href = './perfil.html';
                } else {
                    alert('Erro ao criar conta: ' + (data.error || 'Erro desconhecido'));
                }
            } catch (err) {
                console.error('Erro ao conectar ao servidor:', err);
                alert('Não foi possível conectar ao servidor. Tente novamente mais tarde.');
            }
        });
    </script>
</body>

</html>