<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vip cortes</title>
  <link rel="stylesheet" href="fidelidade.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Big+Shoulders:opsz,wght@10..72,100..900&display=swap"
    rel="stylesheet">

</head>

<body>
  <header>
    <div class="traco1">
      <img class="tracos" src="./assets/menu (sidebar).png" alt="3 traços">
    </div>
    <div class="caixa-one">
      <img class="img-one" src="./assets/Vip cortes logo.png" alt="logo">
      <a class="item" href="./index.html"><b>Home</b></a>
      <a class="item" href="./Avaliações.html"><b>Avaliações</b></a>
      <a class="item" href="./AGENDAR.html"><b>Agendar</b></a>

    </div>

    <div class="caixa-two">
      <a class="item-two" href="./cartaofidelidade.html"><b>Entrar</b></a>
      <a class="item-three" href="./criandoconta.html"><b>Cadastre-se</b></a>

    </div>
   
  </header>
    
  <div class="line"></div>
  <section>
    <span class="item-four"><b>CARTÃO</b></span>
    <span class="item-five"><b>FIDELIDADE</b></span>

  </section>
  <main>
    <img src="./assets/tela 1.png" alt="tela" class="tela">
    <div class="caixa-ten">
        <input id="email" type="text" placeholder="Email:" class="botao">
        <input id="senha" type="password" placeholder="Senha:" class="botao2">
      </div>
      <div class="caixa-eleven">
        <button id="btnEntrar" class="botao3">Entrar Agora</button>
        <button id="btnCancelar" class="botao4">Cancelar Cartão</button>
    </div>
    <div id="mensagem" style="margin-top:12px;color:#900;font-weight:bold"></div>
    <div class="caixa-aviso">
      <span>Caso não Possua um login, pressione O BOTÃO “CADASTRAR-SE” PARA USUFRUIR DE DESCONTOS E BÔNUS INCRÍVEIS POR APENAS CORTAR O CABELO REGULARMENTE! </span>

    </div>
    <div class="caixa-cadastre">
      <a class="botao5" href="criandoconta.html">CADASTRE-SE</a>
    </div>
  </main>

  <script>
    async function login() {
      const email = document.getElementById('email').value.trim();
      const senha = document.getElementById('senha').value.trim();
      const msg = document.getElementById('mensagem');
      msg.textContent = '';
      if (!email || !senha) { msg.textContent = 'Preencha email e senha.'; return; }
      try {
        const res = await fetch('/api/login', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, senha })
        });
        const j = await res.json();
        if (!res.ok) { msg.textContent = j.error || 'Erro no login'; return; }
        // salvar userId e redirecionar para perfil
        localStorage.setItem('userId', j.userId);
        window.location.href = 'perfil (2).html';
      } catch (err) {
        console.error(err);
        msg.textContent = 'Erro ao conectar ao servidor.';
      }
    }

    async function cancelarCartao() {
      const msg = document.getElementById('mensagem');
      msg.textContent = '';
      const userId = localStorage.getItem('userId');
      if (!userId) { msg.textContent = 'Faça login primeiro para cancelar o cartão.'; return; }
      try {
        const res = await fetch(`/api/fidelities/${encodeURIComponent(userId)}/cancel`, { method: 'POST' });
        const j = await res.json();
        if (!res.ok) { msg.textContent = j.error || 'Erro ao cancelar'; return; }
        msg.style.color = 'green';
        msg.textContent = j.message || 'Cartão cancelado com sucesso';
      } catch (err) {
        console.error(err);
        msg.textContent = 'Erro ao conectar ao servidor.';
      }
    }

    document.getElementById('btnEntrar').addEventListener('click', login);
    document.getElementById('btnCancelar').addEventListener('click', cancelarCartao);
  </script>
</body>

</html>


